<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contacto · Mi sitio</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="styles.css" rel="stylesheet">
</head>

<body>

  <header class="bg-white border-bottom sticky-top">
    <div class="container py-3 d-flex justify-content-between align-items-center">
      <h1 class="h4 m-0">DINAMARCA</h1>
      <nav class="d-flex gap-3">
        <a href="index.html">Inicio</a>
        <a href="about.html">Acerca</a>
        <a href="contact.html">Contacto</a>
        <a href="store.html">Store</a>
      </nav>
    </div>
    </header>
<main class="container py-5">

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-end gap-3 mb-4">
      <div>
        <h2 class="h5 mb-1">Tienda</h2>
        <p class="text-muted mb-0">
          Productos cargados desde Firebase Realtime Database (ruta: <code>store</code>).
        </p>
      </div>

      <!-- Filtro por categoría (front-end) -->
      <div class="d-flex align-items-center gap-2">
        <label class="form-label mb-0">Categoría</label>
        <select id="filtroCategoria" class="form-select" style="max-width: 240px;">
          <option value="Todas">Todas</option>
        </select>
      </div>
    </div>

    <!-- Grid de productos -->
    <div id="gridProductos" class="row g-3"></div>

    <!-- Estado -->
    <div id="status" class="mt-3"></div>

  </main>

  <!-- Footer -->
  <footer class="bg-white border-top">
    <div class="container py-3 text-center text-muted">
      <small>© 2026 · Mi sitio</small>
    </div>
  </footer>


  <!-- Firebase Realtime Database -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

    // Tu config (Realtime Database usa databaseURL)
   const firebaseConfig = {
    apiKey: "AIzaSyAQM04Js4yBix94z6oCOfa8sZ84WCrDTUY",
    authDomain: "webstudio-ce0dc.firebaseapp.com",
    projectId: "webstudio-ce0dc",
    storageBucket: "webstudio-ce0dc.firebasestorage.app",
    messagingSenderId: "1078506531688",
    appId: "1:1078506531688:web:7378ec65889b294a4b44dd"
  };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const grid = document.getElementById("gridProductos");
    const status = document.getElementById("status");
    const filtro = document.getElementById("filtroCategoria");

    // Aquí guardaremos la lista de productos como array
    let productos = [];

    // Render de cards en el grid
    function render(lista) {
      grid.innerHTML = "";

      if (lista.length === 0) {
        grid.innerHTML = `
          <div class="col-12">
            <div class="alert alert-warning mb-0">No hay productos para mostrar.</div>
          </div>`;
        return;
      }

      for (const p of lista) {
        const col = document.createElement("div");
        col.className = "col-12 col-md-4";

        col.innerHTML = `
          <article class="card h-100 shadow-sm">
            <img src="${p.imagen}" class="card-img-top" alt="${p.nombre}">
            <div class="card-body d-flex flex-column">
              <div class="d-flex justify-content-between align-items-start gap-2">
                <h3 class="h6 card-title mb-1">${p.nombre}</h3>
                <span class="badge text-bg-dark">${p.categoria}</span>
              </div>

              <p class="text-muted mb-3">$${p.precio}</p>

              <button class="btn btn-success mt-auto" type="button">
                Agregar
              </button>
            </div>
          </article>
        `;

        grid.appendChild(col);
      }
    }

    // Llena el select de categorías basado en los productos cargados
    function poblarCategorias(lista) {
      const categorias = ["Todas", ...new Set(lista.map(p => p.categoria))];
      filtro.innerHTML = categorias.map(c => `<option value="${c}">${c}</option>`).join("");
    }

    // Filtra en el front-end
    filtro.addEventListener("change", () => {
      const cat = filtro.value;
      const filtrados = (cat === "Todas") ? productos : productos.filter(p => p.categoria === cat);
      render(filtrados);
    });

    // Lectura en tiempo real desde la ruta "store"
    status.innerHTML = `<div class="alert alert-info">Cargando productos…</div>`;

    onValue(ref(db, "store"), (snapshot) => {
      const data = snapshot.val();

      if (!data) {
        productos = [];
        poblarCategorias(productos);
        render(productos);
        status.innerHTML = `<div class="alert alert-warning">No hay datos en <code>store</code>.</div>`;
        return;
      }

      // data es un objeto: { item01: {...}, item02: {...}, ... }
      // Lo convertimos a array con id incluido:
      productos = Object.entries(data).map(([id, p]) => ({
        id,
        ...p
      }));

      poblarCategorias(productos);
      render(productos);

      status.innerHTML = `<div class="alert alert-success">Productos cargados: ${productos.length}</div>`;
    }, (err) => {
      console.error(err);
      status.innerHTML = `<div class="alert alert-danger">Error al leer productos: ${err.message}</div>`;
    });

  </script>